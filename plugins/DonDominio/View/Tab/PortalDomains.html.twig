{# Vista de dominios para el portal del cliente #}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
                    {# Notificación de dominios próximos a expirar #}
                    {% if view.expiring_count > 0 %}
                    <div class="alert alert-danger d-flex align-items-center mb-3">
                        <i class="fa-solid fa-exclamation-triangle me-2"></i>
                        <div>
                            <strong>¡Atención!</strong> Tienes {{ view.expiring_count }} dominio(s) que expira(n) en menos de 30 días:
                            <ul class="mb-0 mt-2">
                                {% for domain in view.expiring_domains %}
                                <li><strong>{{ domain.name }}</strong> - Expira el {{ domain.expiration|date('d/m/Y') }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                    {% endif %}

                    {% if view.cursor is empty %}
                    <div class="alert alert-info">
                        <i class="fa-solid fa-info-circle me-2"></i>
                        No tienes dominios registrados asociados a tu contacto.
                    </div>
                    {% else %}
                    <div class="row">
                        {% for contact in view.cursor %}
                        <div class="col-12 mb-4">
                            <div class="card border-primary">
                                <div class="card-header bg-light">
                                    <h6 class="mb-0">
                                        <i class="fa-solid fa-user-circle me-2 text-primary"></i>
                                        {{ contact.name ?: 'Contacto' }}
                                        <small class="text-muted ms-2">{{ contact.tax_number }}</small>
                                    </h6>
                                </div>
                                <div class="card-body">
                                    {% if contact.domains is empty %}
                                    <p class="text-muted mb-0">No hay dominios asociados a este contacto.</p>
                                    {% else %}
                                    <div class="row">
                                        {% for domain in contact.domains %}
                                        <div class="col-12 mb-3">
                                            <div class="card h-100 border-secondary">
                                                <div class="card-body">
                                                    <div class="row">
                                                        <div class="col-lg-2 col-md-3 mb-3">
                                                            <h6 class="card-title mb-2">
                                                                <strong>{{ domain.name }}</strong>
                                                            </h6>

                                                            {# Estado del dominio #}
                                                            {% set statusMap = {
                                                                'active': {'class': 'success', 'icon': 'circle-check', 'text': 'Activo'},
                                                                'pending': {'class': 'warning', 'icon': 'clock', 'text': 'Pendiente'},
                                                                'expired': {'class': 'danger', 'icon': 'circle-xmark', 'text': 'Expirado'},
                                                                'suspended': {'class': 'secondary', 'icon': 'pause', 'text': 'Suspendido'}
                                                            } %}
                                                            {% set status = statusMap[domain.status] ?? {'class': 'secondary', 'icon': 'circle-question', 'text': domain.status|capitalize} %}
                                                            <span class="badge bg-{{ status.class }} mb-2">
                                                                <i class="fa-solid fa-{{ status.icon }} me-1"></i>{{ status.text }}
                                                            </span>

                                                            {# Información adicional para dominios activos #}
                                                            {% if domain.status == 'active' %}
                                                            <div class="mt-2">
                                                                <small class="text-success">
                                                                    <i class="fa-solid fa-shield-alt me-1"></i>
                                                                    Dominio protegido
                                                                </small>
                                                            </div>
                                                            {% endif %}
                                                        </div>

                                                        <div class="col-lg-2 col-md-3 mb-3">
                                                            {# Información básica #}
                                                            <div class="small text-muted">
                                                                {% if domain.expiration %}
                                                                <div class="mb-1"><i class="fa-solid fa-calendar me-1"></i><strong>Expira:</strong> {{ domain.expiration|date('d/m/Y') }}</div>
                                                                {% endif %}
                                                                {% if domain.created %}
                                                                <div class="mb-1"><i class="fa-solid fa-clock me-1"></i><strong>Registrado:</strong> {{ domain.created|date('d/m/Y') }}</div>
                                                                {% endif %}
                                                            </div>

                                                            {# Información de contactos (horizontal y pequeño) #}
                                                            <div class="mt-2">
                                                                <small class="text-muted d-block mb-1"><strong>Contactos:</strong></small>
                                                                <div class="d-flex flex-wrap gap-1">
                                                                    {% if domain.registrant %}
                                                                    <small class="badge bg-light text-dark">R: {{ domain.registrant }}</small>
                                                                    {% endif %}
                                                                    {% if domain.admin %}
                                                                    <small class="badge bg-light text-dark">A: {{ domain.admin }}</small>
                                                                    {% endif %}
                                                                    {% if domain.tech %}
                                                                    <small class="badge bg-light text-dark">T: {{ domain.tech }}</small>
                                                                    {% endif %}
                                                                    {% if domain.billing %}
                                                                    <small class="badge bg-light text-dark">B: {{ domain.billing }}</small>
                                                                    {% endif %}
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="col-lg-2 col-md-3 mb-3">
                                                            {# Herramientas - Botones de acceso directo #}
                                                            <div class="d-flex flex-wrap gap-1">
                                                                {% if domain.tools_urls.mail is defined %}
                                                                <a href="{{ domain.tools_urls.mail.url }}" target="_blank" class="btn btn-sm {{ domain.tools_urls.mail.class }} mb-1">
                                                                    <i class="{{ domain.tools_urls.mail.icon }} me-1"></i>{{ domain.tools_urls.mail.label }}
                                                                </a>
                                                                {% endif %}

                                                                {% if domain.tools_urls.web is defined %}
                                                                <a href="{{ domain.tools_urls.web.url }}" target="_blank" class="btn btn-sm {{ domain.tools_urls.web.class }} mb-1">
                                                                    <i class="{{ domain.tools_urls.web.icon }} me-1"></i>{{ domain.tools_urls.web.label }}
                                                                </a>
                                                                {% endif %}

                                                                {% if domain.tools_urls.erp is defined %}
                                                                <a href="{{ domain.tools_urls.erp.url }}" target="_blank" class="btn btn-sm {{ domain.tools_urls.erp.class }} mb-1">
                                                                    <i class="{{ domain.tools_urls.erp.icon }} me-1"></i>{{ domain.tools_urls.erp.label }}
                                                                </a>
                                                                {% endif %}

                                                                {# Enlace WHOIS #}
                                                                {% if domain.whois_url is defined %}
                                                                <a href="{{ domain.whois_url }}" target="_blank" class="btn btn-sm btn-outline-info">
                                                                    <i class="fa-solid fa-search me-1"></i>WHOIS
                                                                </a>
                                                                {% endif %}
                                                            </div>
                                                        </div>

                                                        <div class="col-lg-3 col-md-6 mb-3">
                                                            {# Auto-renovación #}
                                                            <div class="mb-2">
                                                                {% if domain.autorenew %}
                                                                <span class="badge bg-success">
                                                                    <i class="fa-solid fa-rotate me-1"></i>Auto-renovación activada
                                                                </span>
                                                                {% else %}
                                                                <span class="badge bg-warning">
                                                                    <i class="fa-solid fa-rotate me-1"></i>Auto-renovación desactivada
                                                                </span>
                                                                {% endif %}
                                                            </div>

                                                            {# Botón para activar auto-renovación #}
                                                            {% if not domain.autorenew %}
                                                            <div class="mt-2">
                                                                <small class="text-muted d-block mb-1">
                                                                    <i class="fa-solid fa-info-circle me-1"></i>
                                                                    Para activar la auto-renovación, debe firmar la domiciliación bancaria
                                                                </small>
                                                                <a href="https://filedn.eu/litOB0SUT8q5aLOM933djFm/Contrato%20domiciliaci%C3%B3n-Solwed.pdf"
                                                                   target="_blank"
                                                                   class="btn btn-sm btn-outline-primary">
                                                                    <i class="fa-solid fa-download me-1"></i>Descargar contrato
                                                                </a>
                                                            </div>
                                                            {% endif %}
                                                        </div>

                                                        <div class="col-lg-3 col-md-6 mb-3">
                                                            {# Nameservers #}
                                                            {% if domain.nameservers %}
                                                            <div>
                                                                <small class="text-muted d-block mb-1"><strong>Nameservers:</strong></small>
                                                                <div class="small">
                                                                    {% for ns in domain.nameservers %}
                                                                    <code class="d-block mb-1">{{ ns }}</code>
                                                                    {% endfor %}
                                                                </div>
                                                            </div>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                    {% endif %}


                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
        </div>
    </div>
</div>

<style>
    .card-title {
        font-size: 1rem;
    }

    code {
        font-size: 0.75rem;
        background-color: #f8f9fa;
        padding: 1px 4px;
        border-radius: 3px;
    }

    .badge {
        font-size: 0.75rem;
    }
</style>
